apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kube-system

resources:
  - serviceaccount.yaml
  - clusterrole.yaml
  - clusterrolebinding.yaml
  - role.yaml
  - deployment.yaml
  - service.yaml
  - ingressclass.yaml

# =============================================================================
# UPDATE THESE VALUES FOR YOUR ENVIRONMENT
# =============================================================================
# Required values to configure:
#   - ACCOUNT_ID:   Your AWS account ID (e.g., 754250776154)
#   - CLUSTER_NAME: Your EKS cluster name (e.g., regional-hn46)
#   - VPC_ID:       Your VPC ID (e.g., vpc-0abc123def456789)
#   - AWS_REGION:   Your AWS region (e.g., us-east-2)
#
# To find your VPC ID, run:
#   aws eks describe-cluster --name <cluster-name> --region <region> \
#     --query 'cluster.resourcesVpcConfig.vpcId' --output text
# =============================================================================

patches:
  - target:
      kind: ServiceAccount
      name: aws-load-balancer-controller
    patch: |-
      - op: replace
        path: /metadata/annotations/eks.amazonaws.com~1role-arn
        value: arn:aws:iam::ACCOUNT_ID:role/aws-load-balancer-controller-role
  - target:
      kind: Deployment
      name: aws-load-balancer-controller
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/args
        value:
          - --cluster-name=CLUSTER_NAME
          - --ingress-class=alb
          - --aws-vpc-id=VPC_ID
          - --aws-region=AWS_REGION
